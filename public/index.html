<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mouse Arts & Letters Club - Donate</title>
<script src="https://js.stripe.com/terminal/v1/"></script>
<style>
  body {
    font-family: 'Helvetica Neue', Arial, sans-serif;
    background: linear-gradient(to bottom, #fefefe, #e0f0ff);
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  header {
    text-align: center;
    padding: 40px 20px 20px;
  }

  header img {
    max-width: 150px;
    margin-bottom: 20px;
  }

  header h1 {
    font-size: 36px;
    margin: 0;
    color: #333;
  }

  #buttons {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    margin-top: 40px;
    gap: 20px;
  }

  button.donation {
    font-size: 28px;
    padding: 25px 50px;
    border-radius: 15px;
    border: none;
    cursor: pointer;
    transition: transform 0.1s, background 0.2s;
    background: #2e7d32;
    color: white;
    flex: 1 1 200px;
    max-width: 250px;
  }

  button.donation:hover {
    background: #1b5e20;
  }

  button.donation:active {
    transform: scale(0.95);
  }

  #status {
    margin-top: 50px;
    font-size: 24px;
    color: #444;
    min-height: 30px;
  }
</style>
</head>
<body>

<header>
  <img src="mouse.jpeg" alt="Mouse Arts & Letters Club Logo">
  <h1>Mouse Arts & Letters Club</h1>
</header>

<div id="buttons"></div>
<div id="status"></div>

<script>
let donationOptions = [];
const extraOptions = [1500]; // $15 hardcoded for now

async function fetchConfig() {
  try {
    const res = await fetch("/api/config");
    const data = await res.json();
    donationOptions = data.options.concat(extraOptions); // $15 added
    renderButtons();
  } catch (err) {
    document.getElementById("status").innerText = "Failed to load config";
    console.error(err);
  }
}

function renderButtons() {
  const container = document.getElementById("buttons");
  container.innerHTML = "";

  donationOptions.forEach(amount => {
    const btn = document.createElement("button");
    btn.className = "donation";
    btn.innerText = `$${(amount/100).toFixed(2)}`;
    btn.onclick = () => startDonation(amount);
    container.appendChild(btn);
  });
}

async function startDonation(amount) {
  const status = document.getElementById("status");
  status.innerText = `Preparing $${(amount/100).toFixed(2)} donation…`;

  try {
    const res = await fetch("/api/create-payment-intent", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ amount })
    });

    const data = await res.json();

    if (data.error) {
      status.innerText = `Error: ${data.error}`;
      return;
    }

    status.innerText = `✅ Donation ready! Tap reader once Stripe is set up.`;
  } catch (err) {
    console.error(err);
    status.innerText = "Error creating donation.";
  }
}

// Initialize kiosk
fetchConfig();
setInterval(fetchConfig, 30000); // refresh every 30s
</script>

</body>
</html>
